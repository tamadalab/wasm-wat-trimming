version: '3.8'

services:
  # ==========================================
  # 1. Bubble Sort (bubsort)
  # ソース: data/bubsort/src/
  # ==========================================
  bubsort-c:
    build: ./docker-images/c
    volumes:
      - ./data/bubsort/src:/src
      - ./data/bubsort/c:/output
    command: emcc /src/bubsうort.c -O3 -o /output/bubsort.wasm

  bubsort-js:
    build: ./docker-images/js
    volumes:
      - ./data/bubsort/src:/src
      - ./data/bubsort/js:/output
    # Javyを使って JS -> Wasm にコンパイル
    command: javy compile /src/bubsort.js -o /output/bubsort.wasm

  bubsort-ts:
    build: ./docker-images/ts
    volumes:
      - ./data/bubsort/src:/src
      - ./data/bubsort/ts:/output
    # ascコマンドでコンパイル
    # -O3: 最適化レベル3 (C言語の指定と合わせる)
    # --outFile: 出力先
    command: asc /src/bubsort.ts -O3 --outFile /output/bubsort.wasm

  bubsort-go:
    build: ./docker-images/go
    volumes:
      - ./data/bubsort/src:/src
      - ./data/bubsort/go:/output
    # -target=wasm: Wasm向けにビルド
    # -no-debug: デバッグ情報を削除してWATファイルを読みやすくする（構造分析に推奨）
    command: tinygo build -o /output/bubsort.wasm -target=wasm -no-debug /src/bubsort.go
